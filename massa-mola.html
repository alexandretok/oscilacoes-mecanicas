<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <style type="text/css">
        canvas {
            border: 2px solid grey;
            background-color: #E6F9FF;
        }
        #crate {
            display: none;
        }
    </style>
    <script type="text/javascript" src="js/jquery.js"></script>
</head>
<body>
    <canvas id="canvas" width="1000" height="270">
        Navegador não suporta HTML5
    </canvas>
    <div>
        <p>
            <label for="kMola">Coeficiente de Elasticidade</label> <input type="range" max="100" min="1" id="kMola">
        </p>
        <p>
            <label for="massa">Massa</label> <input type="range" max="100" min="1" id="massa">
        </p>
        <p>
            <label for="velocidade">Velocidade da Simulacao</label> <input type="range" max="500" min="100" id="velocidade">
        </p>
        <p>
            <button id="pause">Pause</button>
        </p>
    </div>
    <img id="crate" src="crate.png">
    <script type="text/javascript">
        $(document).ready(function(){
            inicializar();
            /* Iniciando os controles dos valores do sistema */
            $('#kMola').val(kMola);
            $('#massa').val(massa);
            $('#velocidade').val(velocidadeAnimacao);
            /* Eventos de alteracao dos valores do sistema */
            $('#kMola').change(function(){
                kMola = this.value;
            });
            $('#massa').change(function(){
                massa = this.value;
            });
            $('#velocidade').change(function(){
                velocidadeAnimacao = this.value;
            });
            $('#pause').click(function () {
                if(drawInterval){
                    clearInterval(drawInterval);
                    drawInterval = false;
                }else{
                    drawInterval = setInterval(draw, tempoDeAtualizacaoDoCanvas);
                }
            });
        });
        var canvas, rangeKMola, imgCaixa, velocidadeAnimacao, drawInterval,  context, tempo, tempoDeAtualizacaoDoCanvas, massaAltura, massaLargura, massa, massaPosicaoX, massaPosicaoXOriginal, massaVelocidade, kMola, x0, xp;

        function inicializar() {
            massaAltura = 200;
            massaLargura = 200;

            x0 = 100;   /* Posicao inicial */
            xp = 0;     /* Velocidade inicial */

            kMola = 10;
            massa = 10;

            massaPosicaoXOriginal = 600;
            massaPosicaoX = x0 + massaPosicaoXOriginal;

            tempoDeAtualizacaoDoCanvas = 30;
            velocidadeAnimacao = 150; /* Padrao = 150 */
            tempo = 90;

            canvas = document.getElementById("canvas");
            context = canvas.getContext("2d");
            context.font = "bold 16px Arial";

            imgCaixa = document.getElementById("crate");

            drawInterval = setInterval(draw, tempoDeAtualizacaoDoCanvas)
        }

        function changeValues(){
            tempo += tempoDeAtualizacaoDoCanvas/velocidadeAnimacao;
            massaPosicaoX = massaPosicaoXOriginal + x0 * Math.sin(Math.sqrt(kMola) * tempo / Math.sqrt(massa)) + xp * Math.cos(Math.sqrt(kMola) * tempo / Math.sqrt(massa));
        }

        function draw(){
            context.clearRect(0, 0, canvas.width, canvas.height); /* Limpa a tela */
            context.fillRect(massaPosicaoX, canvas.height - massaAltura, massaLargura, massaAltura); /* Desenha a posicao do jogar */


            /*Desenhando a escala na parte superior*/
            /*Cada ponto na escala equivale a 100px */
            context.beginPath();
            alturaEscala = canvas.height - massaAltura - 5;
            context.moveTo(0, alturaEscala);
            context.lineTo(canvas.width, alturaEscala);
            for(i=0;i<=canvas.width;i+=100){
                context.moveTo(i, alturaEscala);
                if(i == 0)
                    back = 0;
                else if(i == canvas.width)
                    back = i - 20;
                else back = i - 5;
                context.fillText(i/100, back, alturaEscala - 10);
                context.moveTo(i, alturaEscala - 5);
                context.lineTo(i, alturaEscala + 5);
            }

            context.drawImage(imgCaixa, massaPosicaoX, canvas.height - massaAltura);

            /* Desenhando a mola */
            xAtual = 0;
            yAtual = canvas.height - massaAltura/2;
            y0 = yAtual;
            nAspirais = 15;
            comprimentoAspiral = 8;
            deslocamentoXPixels = (massaPosicaoX - massaPosicaoXOriginal) + 100;
            deslocamentoXPorAspiral = deslocamentoXPixels/(nAspirais*2);
            deslocamentoYPorAspiral = comprimentoAspiral*comprimentoAspiral - Math.sqrt(Math.pow(deslocamentoXPorAspiral, 2));

            context.moveTo(xAtual, yAtual);
            context.lineTo(xAtual += 200, yAtual);

            deslocamentoXPorAspiral += 2;

            for(i=0;i<nAspirais/2;i++) {
                /* Desenha as espirais */
                context.lineTo(xAtual += deslocamentoXPorAspiral, yAtual += deslocamentoYPorAspiral);
                context.lineTo(xAtual += deslocamentoXPorAspiral, yAtual = y0);
                context.lineTo(xAtual += deslocamentoXPorAspiral, yAtual -= deslocamentoYPorAspiral);
                context.lineTo(xAtual += deslocamentoXPorAspiral, yAtual = y0);
            }


            /* Escrevendo informacoes do sistema */
            context.fillText("k = " + kMola + " N/m", 10, y0 - 10);
            context.fillText("m = " + massa + " kg", massaPosicaoX - 100, y0 - 10);
            context.fillText("Equação do sistema:   m۰Ẍ + K۰x = 0", 10, 25);

            context.lineTo(massaPosicaoX, yAtual);
            context.stroke();

            changeValues();
        }
    </script>
</body>
</html>